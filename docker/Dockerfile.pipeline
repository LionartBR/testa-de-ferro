FROM python:3.12-slim

RUN groupadd -r app && useradd -r -g app app

WORKDIR /app

COPY pyproject.toml .
RUN pip install --no-cache-dir .

COPY pipeline/ ./pipeline/

RUN mkdir -p /app/pipeline/data/raw /app/pipeline/data/staging /app/pipeline/data/output && \
    chown -R app:app /app/pipeline/data

USER app

CMD ["python", "pipeline/main.py"]
